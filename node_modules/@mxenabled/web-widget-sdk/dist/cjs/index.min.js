"use strict";function e(e){return"clientId"in e&&"string"==typeof e.clientId&&"apiKey"in e&&"string"==typeof e.apiKey&&"userGuid"in e&&"string"==typeof e.userGuid&&"environment"in e&&"string"==typeof e.environment}Object.defineProperty(exports,"__esModule",{value:!0});class t extends Error{constructor(){super("Missing required widget props!\n\nComponent needs one of the following groups of props:\n\n  - url\n\n    - or -\n\n  - proxy\n\n    - or -\n\n  - apiKey\n  - clientId\n  - environment\n  - userGuid"),Object.setPrototypeOf(this,t.prototype)}}class n extends Error{constructor(e){super(`Request failed: ${e}`),this.statusCode=e,Object.setPrototypeOf(this,n.prototype)}}var i;!function(e){e.SAND="sand",e.QA="qa",e.INT="integration",e.PROD="production"}(i||(i={}));const s={[i.SAND]:i.SAND,[i.QA]:i.QA,[i.INT]:i.INT,[i.PROD]:i.PROD};const r={[i.SAND]:"https://api.sand.internal.mx",[i.QA]:"https://api.qa.internal.mx",[i.INT]:"https://int-api.mx.com",[i.PROD]:"https://api.mx.com"};function o(e){const t=function(e){const t=s[e];if(!t)throw new Error(`Invalid MX environment: ${e}`);return t}(e),n=r[t];if(!n)throw new Error(`Missing host for MX environment: ${e}`);return n}var c;function a(e){return{client_redirect_url:e.clientRedirectUrl,color_scheme:e.colorScheme,current_institution_code:e.currentInstitutionCode,current_institution_guid:e.currentInstitutionGuid,current_member_guid:e.currentMemberGuid,disable_institution_search:e.disableInstitutionSearch,include_transactions:e.includeTransactions,is_mobile_webview:e.isMobileWebview||!1,mode:e.mode,oauth_referral_source:e.oauthReferralSource,ui_message_version:e.uiMessageVersion||4,ui_message_webview_url_scheme:e.uiMessageWebviewUrlScheme,update_credentials:e.updateCredentials,widget_type:e.widgetType}}function u(e){return e.widget_url.url}function d(n){const i=function(n){if(function(e){return"proxy"in e&&"string"==typeof e.proxy}(n))return function(e){return e.proxy}(n);if(e(n))return function(e){const t=o(e.environment),n=e.userGuid;return`${t}/users/${n}/widget_urls`}(n);throw new t}(n),s=function(t){const n={Accept:"application/vnd.mx.api.v1+json","Content-Type":"application/json"};t.language&&(n["Accept-Language"]=t.language);if(e(t)){const{apiKey:e,clientId:i}=t,s=btoa(`${i}:${e}`);n.Authorization=`Basic ${s}`}const i="cors",s="POST",r=JSON.stringify({widget_url:a(t)});return{method:s,headers:n,body:r,mode:i}}(n);return{url:i,options:s}}function g(e){return e}function m(e){if(!e.ok)throw new n(e.status);return e.json()}function p(e){console.error(e)}!function(e){e.AccountsWidget="accounts_widget",e.BudgetsWidget="budgets_widget",e.ConnectWidget="connect_widget",e.ConnectionsWidget="connections_widget",e.DebtsWidget="debts_widget",e.FinstrongWidget="finstrong_widget",e.GoalsWidget="goals_widget",e.HelpWidget="help_widget",e.MasterWidget="master_widget",e.MiniBudgetsWidget="mini_budgets_widget",e.MiniFinstrongWidget="mini_finstrong_widget",e.MiniPulseCarouselWidget="mini_pulse_carousel_widget",e.MiniSpendingWidget="mini_spending_widget",e.PulseWidget="pulse_widget",e.SettingsWidget="settings_widget",e.SpendingWidget="spending_widget",e.TransactionsWidget="transactions_widget",e.TrendsWidget="trends_widget"}(c||(c={}));class l extends Error{messageType;field;expectedType;gotValue;constructor(e,t,n,i){super(`Unable to decode '${t}' from '${e}'`),this.messageType=e,this.field=t,this.expectedType=n,this.gotValue=i,Object.setPrototypeOf(this,l.prototype)}}class _ extends Error{postMessageType;constructor(e){super(`Unknown post message: ${e}`),this.postMessageType=e,Object.setPrototypeOf(this,_.prototype)}}function C(e,t,n,i,s={}){const r=e[n],o=void 0!==r,c="string"==typeof r,a="number"==typeof r,u="object"==typeof r&&!Array.isArray(r),d="boolean"==typeof r,g="string"===i,m="number"===i,p=i instanceof Array,_="object"==typeof i&&!Array.isArray(i),h="boolean"===i;if(o||!s.optional){if(!o)throw new l(t,n,i,r);if(g&&!c)throw new l(t,n,i,r);if(m&&!a)throw new l(t,n,i,r);if(!(!p||c&&i.includes(r)))throw new l(t,n,i,r);if(_&&!u)throw new l(t,n,i,r);if(h&&!d)throw new l(t,n,i,r);_&&u&&Object.keys(i).forEach((e=>{C(r,t,e,i[e])}))}}var h;!function(e){e.Load="mx/load",e.Ping="mx/ping",e.Navigation="mx/navigation",e.FocusTrap="mx/focusTrap",e.ClientOAuthComplete="mx/client/oauthComplete",e.ConnectLoaded="mx/connect/loaded",e.ConnectEnterCredentials="mx/connect/enterCredentials",e.ConnectInstitutionSearch="mx/connect/institutionSearch",e.ConnectSelectedInstitution="mx/connect/selectedInstitution",e.ConnectMemberConnected="mx/connect/memberConnected",e.ConnectConnectedPrimaryAction="mx/connect/connected/primaryAction",e.ConnectMemberDeleted="mx/connect/memberDeleted",e.ConnectCreateMemberError="mx/connect/createMemberError",e.ConnectMemberStatusUpdate="mx/connect/memberStatusUpdate",e.ConnectOAuthError="mx/connect/oauthError",e.ConnectOAuthRequested="mx/connect/oauthRequested",e.ConnectStepChange="mx/connect/stepChange",e.ConnectSubmitMFA="mx/connect/submitMFA",e.ConnectUpdateCredentials="mx/connect/updateCredentials",e.PulseOverdraftWarningCtaTransferFunds="mx/pulse/overdraftWarning/cta/transferFunds",e.AccountCreated="mx/account/created"}(h||(h={}));const b={[h.Load]:h.Load,[h.Ping]:h.Ping,[h.Navigation]:h.Navigation,[h.FocusTrap]:h.FocusTrap,"mx/focustrap":h.FocusTrap,[h.ClientOAuthComplete]:h.ClientOAuthComplete,"mx/client/oauthcomplete":h.ClientOAuthComplete,[h.ConnectLoaded]:h.ConnectLoaded,[h.ConnectEnterCredentials]:h.ConnectEnterCredentials,"mx/connect/entercredentials":h.ConnectEnterCredentials,[h.ConnectInstitutionSearch]:h.ConnectInstitutionSearch,"mx/connect/institutionsearch":h.ConnectInstitutionSearch,[h.ConnectSelectedInstitution]:h.ConnectSelectedInstitution,"mx/connect/selectedinstitution":h.ConnectSelectedInstitution,[h.ConnectMemberConnected]:h.ConnectMemberConnected,"mx/connect/memberconnected":h.ConnectMemberConnected,[h.ConnectConnectedPrimaryAction]:h.ConnectConnectedPrimaryAction,"mx/connect/connected/primaryaction":h.ConnectConnectedPrimaryAction,[h.ConnectMemberDeleted]:h.ConnectMemberDeleted,"mx/connect/memberdeleted":h.ConnectMemberDeleted,[h.ConnectCreateMemberError]:h.ConnectCreateMemberError,"mx/connect/createmembererror":h.ConnectCreateMemberError,[h.ConnectMemberStatusUpdate]:h.ConnectMemberStatusUpdate,"mx/connect/memberstatusupdate":h.ConnectMemberStatusUpdate,[h.ConnectOAuthError]:h.ConnectOAuthError,"mx/connect/oautherror":h.ConnectOAuthError,[h.ConnectOAuthRequested]:h.ConnectOAuthRequested,"mx/connect/oauthrequested":h.ConnectOAuthRequested,[h.ConnectStepChange]:h.ConnectStepChange,"mx/connect/stepchange":h.ConnectStepChange,[h.ConnectSubmitMFA]:h.ConnectSubmitMFA,"mx/connect/submitmfa":h.ConnectSubmitMFA,[h.ConnectUpdateCredentials]:h.ConnectUpdateCredentials,"mx/connect/updatecredentials":h.ConnectUpdateCredentials,[h.PulseOverdraftWarningCtaTransferFunds]:h.PulseOverdraftWarningCtaTransferFunds,"mx/pulse/overdraftwarning/cta/transferfunds":h.PulseOverdraftWarningCtaTransferFunds,[h.AccountCreated]:h.AccountCreated};function x(e){const t=e.type||"type not provided";let n;if(!t||!(t in b))throw new _(t);n=b[t];const i=function(e,t){switch(e){case h.Load:return{type:e};case h.Ping:return C(t,"mx/ping","user_guid","string"),C(t,"mx/ping","session_guid","string"),{type:e,user_guid:t.user_guid,session_guid:t.session_guid};case h.Navigation:return C(t,"mx/navigation","user_guid","string"),C(t,"mx/navigation","session_guid","string"),C(t,"mx/navigation","did_go_back","boolean"),{type:e,user_guid:t.user_guid,session_guid:t.session_guid,did_go_back:t.did_go_back};case h.FocusTrap:return C(t,"mx/focusTrap","user_guid","string"),C(t,"mx/focusTrap","session_guid","string"),{type:e,user_guid:t.user_guid,session_guid:t.session_guid};case h.ClientOAuthComplete:return C(t,"mx/client/oauthComplete","url","string"),{type:e,url:t.url};case h.ConnectLoaded:return C(t,"mx/connect/loaded","user_guid","string"),C(t,"mx/connect/loaded","session_guid","string"),C(t,"mx/connect/loaded","initial_step",["search","selectMember","enterCreds","mfa","connected","loginError","disclosure"]),{type:e,user_guid:t.user_guid,session_guid:t.session_guid,initial_step:t.initial_step};case h.ConnectEnterCredentials:return C(t,"mx/connect/enterCredentials","user_guid","string"),C(t,"mx/connect/enterCredentials","session_guid","string"),C(t,"mx/connect/enterCredentials","institution",{code:"string",guid:"string"}),{type:e,user_guid:t.user_guid,session_guid:t.session_guid,institution:t.institution};case h.ConnectInstitutionSearch:return C(t,"mx/connect/institutionSearch","user_guid","string"),C(t,"mx/connect/institutionSearch","session_guid","string"),C(t,"mx/connect/institutionSearch","query","string"),{type:e,user_guid:t.user_guid,session_guid:t.session_guid,query:t.query};case h.ConnectSelectedInstitution:return C(t,"mx/connect/selectedInstitution","user_guid","string"),C(t,"mx/connect/selectedInstitution","session_guid","string"),C(t,"mx/connect/selectedInstitution","code","string"),C(t,"mx/connect/selectedInstitution","guid","string"),C(t,"mx/connect/selectedInstitution","name","string"),C(t,"mx/connect/selectedInstitution","url","string"),{type:e,user_guid:t.user_guid,session_guid:t.session_guid,code:t.code,guid:t.guid,name:t.name,url:t.url};case h.ConnectMemberConnected:return C(t,"mx/connect/memberConnected","user_guid","string"),C(t,"mx/connect/memberConnected","session_guid","string"),C(t,"mx/connect/memberConnected","member_guid","string"),{type:e,user_guid:t.user_guid,session_guid:t.session_guid,member_guid:t.member_guid};case h.ConnectConnectedPrimaryAction:return C(t,"mx/connect/connected/primaryAction","user_guid","string"),C(t,"mx/connect/connected/primaryAction","session_guid","string"),{type:e,user_guid:t.user_guid,session_guid:t.session_guid};case h.ConnectMemberDeleted:return C(t,"mx/connect/memberDeleted","user_guid","string"),C(t,"mx/connect/memberDeleted","session_guid","string"),C(t,"mx/connect/memberDeleted","member_guid","string"),{type:e,user_guid:t.user_guid,session_guid:t.session_guid,member_guid:t.member_guid};case h.ConnectCreateMemberError:return C(t,"mx/connect/createMemberError","user_guid","string"),C(t,"mx/connect/createMemberError","session_guid","string"),C(t,"mx/connect/createMemberError","institution_guid","string"),C(t,"mx/connect/createMemberError","institution_code","string"),{type:e,user_guid:t.user_guid,session_guid:t.session_guid,institution_guid:t.institution_guid,institution_code:t.institution_code};case h.ConnectMemberStatusUpdate:return C(t,"mx/connect/memberStatusUpdate","user_guid","string"),C(t,"mx/connect/memberStatusUpdate","session_guid","string"),C(t,"mx/connect/memberStatusUpdate","member_guid","string"),C(t,"mx/connect/memberStatusUpdate","connection_status","number"),{type:e,user_guid:t.user_guid,session_guid:t.session_guid,member_guid:t.member_guid,connection_status:t.connection_status};case h.ConnectOAuthError:return C(t,"mx/connect/oauthError","user_guid","string"),C(t,"mx/connect/oauthError","session_guid","string"),C(t,"mx/connect/oauthError","member_guid","string",{optional:!0}),{type:e,user_guid:t.user_guid,session_guid:t.session_guid,member_guid:t.member_guid};case h.ConnectOAuthRequested:return C(t,"mx/connect/oauthRequested","user_guid","string"),C(t,"mx/connect/oauthRequested","session_guid","string"),C(t,"mx/connect/oauthRequested","url","string"),C(t,"mx/connect/oauthRequested","member_guid","string"),{type:e,user_guid:t.user_guid,session_guid:t.session_guid,url:t.url,member_guid:t.member_guid};case h.ConnectStepChange:return C(t,"mx/connect/stepChange","user_guid","string"),C(t,"mx/connect/stepChange","session_guid","string"),C(t,"mx/connect/stepChange","previous","string"),C(t,"mx/connect/stepChange","current","string"),{type:e,user_guid:t.user_guid,session_guid:t.session_guid,previous:t.previous,current:t.current};case h.ConnectSubmitMFA:return C(t,"mx/connect/submitMFA","user_guid","string"),C(t,"mx/connect/submitMFA","session_guid","string"),C(t,"mx/connect/submitMFA","member_guid","string"),{type:e,user_guid:t.user_guid,session_guid:t.session_guid,member_guid:t.member_guid};case h.ConnectUpdateCredentials:return C(t,"mx/connect/updateCredentials","user_guid","string"),C(t,"mx/connect/updateCredentials","session_guid","string"),C(t,"mx/connect/updateCredentials","member_guid","string"),C(t,"mx/connect/updateCredentials","institution",{code:"string",guid:"string"}),{type:e,user_guid:t.user_guid,session_guid:t.session_guid,member_guid:t.member_guid,institution:t.institution};case h.PulseOverdraftWarningCtaTransferFunds:return C(t,"mx/pulse/overdraftWarning/cta/transferFunds","account_guid","string"),C(t,"mx/pulse/overdraftWarning/cta/transferFunds","amount","number"),{type:e,account_guid:t.account_guid,amount:t.amount};case h.AccountCreated:return C(t,"mx/account/created","guid","string"),{type:e,guid:t.guid};default:throw new _(e)}}(n,e.metadata||{});return i}function f(e,t,n){if(t instanceof l)n.onInvalidMessageError?.(e,t);else{if(!(t instanceof _))throw t;n.onInvalidMessageError?.(e,t)}}function y(e,t){t.onMessage?.(e)}function w(e,t){try{y(e,t);!function(e,t){switch(e.type){case h.Load:t.onLoad?.(e);break;case h.Ping:t.onPing?.(e);break;case h.Navigation:t.onNavigation?.(e);break;case h.FocusTrap:t.onFocusTrap?.(e);break;case h.AccountCreated:t.onAccountCreated?.(e);break;default:throw new _(e.type)}}(x(e.data),t)}catch(n){f(e,n,t)}}function M(e,t){try{y(e,t);!function(e,t){switch(e.type){case h.Load:t.onLoad?.(e);break;case h.Ping:t.onPing?.(e);break;case h.Navigation:t.onNavigation?.(e);break;case h.FocusTrap:t.onFocusTrap?.(e);break;case h.AccountCreated:t.onAccountCreated?.(e);break;case h.ConnectLoaded:t.onLoaded?.(e);break;case h.ConnectEnterCredentials:t.onEnterCredentials?.(e);break;case h.ConnectInstitutionSearch:t.onInstitutionSearch?.(e);break;case h.ConnectSelectedInstitution:t.onSelectedInstitution?.(e);break;case h.ConnectMemberConnected:t.onMemberConnected?.(e);break;case h.ConnectConnectedPrimaryAction:t.onConnectedPrimaryAction?.(e);break;case h.ConnectMemberDeleted:t.onMemberDeleted?.(e);break;case h.ConnectCreateMemberError:t.onCreateMemberError?.(e);break;case h.ConnectMemberStatusUpdate:t.onMemberStatusUpdate?.(e);break;case h.ConnectOAuthError:t.onOAuthError?.(e);break;case h.ConnectOAuthRequested:t.onOAuthRequested?.(e);break;case h.ConnectStepChange:t.onStepChange?.(e);break;case h.ConnectSubmitMFA:t.onSubmitMFA?.(e);break;case h.ConnectUpdateCredentials:t.onUpdateCredentials?.(e);break;default:throw new _(e.type)}}(x(e.data),t)}catch(n){f(e,n,t)}}function W(e,t){try{y(e,t);!function(e,t){switch(e.type){case h.Load:t.onLoad?.(e);break;case h.Ping:t.onPing?.(e);break;case h.Navigation:t.onNavigation?.(e);break;case h.FocusTrap:t.onFocusTrap?.(e);break;case h.AccountCreated:t.onAccountCreated?.(e);break;case h.PulseOverdraftWarningCtaTransferFunds:t.onOverdraftWarningCtaTransferFunds?.(e);break;default:throw new _(e.type)}}(x(e.data),t)}catch(n){f(e,n,t)}}class A{constructor(e){if(this.isUnmounting=!1,this.options=e,this.iframe=document.createElement("iframe"),this.style=e.style||{border:"none",height:"550px",width:"320px"},this.messageCallback=e=>{this.handleMXPostMessage(e)},"string"==typeof e.container){const t=document.querySelector(e.container);if(!t)throw new Error(`Unable to find widget container. Ensure that an element matching a selector for '${this.options.container}' is available in the DOM before you initialize the widget.`);this.container=t}else{if(!(e.container instanceof Element))throw new Error("Invalid or missing value for container property, expecting a query selector string or a DOM Element.");this.container=e.container}this.setupIframe(),this.setupListener()}get widgetType(){if(this.options.widgetType)return this.options.widgetType;throw new Error("Missing value for widgetType property, expecting a string (eg. connect_widget).")}get dispatcher(){return w}navigateBack(){return new Promise((e=>{const t=this.iframe.contentWindow,n={mx:!0,type:h.Navigation,payload:{action:"back"}};if(!t)throw new Error("Unable to navigate back, iframe element is not available.");const i=t=>{t.data.type===h.Navigation&&(window.removeEventListener("message",i),e(t.data.metadata.did_go_back))};window.addEventListener("message",i,!1),t.postMessage(JSON.stringify(n),this.targetOrigin)}))}ping(){this.postMessageToWidget({type:"ping"})}unmount(){this.isUnmounting=!0,this.teardownListener(),this.teardownIframe()}get targetOrigin(){var e;const t=/^https?:\/\/[^/]+/i;let n;return this.ssoUrl&&this.ssoUrl.match(t)&&(n=null===(e=this.ssoUrl.match(t))||void 0===e?void 0:e[0]),n||"https://widgets.moneydesktop.com"}handleMXPostMessage(e){e.data.mx&&(this.dispatcher(e,this.options),e.data.type===h.Load&&this.postMessageToWidget({type:"mx/sdk/info",metadata:{sdk:"web",version:"0.0.10"}}))}postMessageToWidget(e){if(!this.iframe.contentWindow)throw new Error("Unable to postMessage to widget, iframe doesn't exist");this.iframe.contentWindow.postMessage(JSON.stringify(e),this.targetOrigin)}setupIframe(){(function(e){if(function(e){return"url"in e&&"string"==typeof e.url}(e))return Promise.resolve(e.url);const t=e.ssoRequestBuilder||d,n=e.ssoRequestPreprocess||g,i=e.ssoRequestPostprocess||u,s=e.onSsoUrlLoadError||p,r=n(t(e));return fetch(r.url,r.options).then(m).then(i).catch(s)})(Object.assign(Object.assign({},this.options),{widgetType:this.widgetType})).then((e=>{!this.isUnmounting&&e&&(this.ssoUrl=e,this.iframe.setAttribute("data-test-id","mx-widget-iframe"),this.iframe.setAttribute("title",this.options.iframeTitle||"Widget Iframe"),this.iframe.setAttribute("src",e),Object.keys(this.style).forEach((e=>{this.iframe.style[e]=this.style[e]})),this.container.appendChild(this.iframe))}))}teardownIframe(){this.container.contains(this.iframe)&&this.container.removeChild(this.iframe)}setupListener(){window.addEventListener("message",this.messageCallback,!1)}teardownListener(){window.removeEventListener("message",this.messageCallback,!1)}}exports.AccountsWidget=class extends A{get widgetType(){return c.AccountsWidget}},exports.BudgetsWidget=class extends A{get widgetType(){return c.BudgetsWidget}},exports.ConnectWidget=class extends A{get widgetType(){return c.ConnectWidget}get dispatcher(){return M}},exports.ConnectionsWidget=class extends A{get widgetType(){return c.ConnectionsWidget}},exports.DebtsWidget=class extends A{get widgetType(){return c.DebtsWidget}},exports.FinstrongWidget=class extends A{get widgetType(){return c.FinstrongWidget}},exports.GoalsWidget=class extends A{get widgetType(){return c.GoalsWidget}},exports.HelpWidget=class extends A{get widgetType(){return c.HelpWidget}},exports.MasterWidget=class extends A{get widgetType(){return c.MasterWidget}},exports.MiniBudgetsWidget=class extends A{get widgetType(){return c.MiniBudgetsWidget}},exports.MiniFinstrongWidget=class extends A{get widgetType(){return c.MiniFinstrongWidget}},exports.MiniPulseCarouselWidget=class extends A{get widgetType(){return c.MiniPulseCarouselWidget}get dispatcher(){return W}},exports.MiniSpendingWidget=class extends A{get widgetType(){return c.MiniSpendingWidget}},exports.PulseWidget=class extends A{get widgetType(){return c.PulseWidget}get dispatcher(){return W}},exports.SettingsWidget=class extends A{get widgetType(){return c.SettingsWidget}},exports.SpendingWidget=class extends A{get widgetType(){return c.SpendingWidget}},exports.TransactionsWidget=class extends A{get widgetType(){return c.TransactionsWidget}},exports.TrendsWidget=class extends A{get widgetType(){return c.TrendsWidget}},exports.Widget=A;
