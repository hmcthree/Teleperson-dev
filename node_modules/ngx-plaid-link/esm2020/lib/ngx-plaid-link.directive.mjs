import { Directive, EventEmitter, HostBinding, HostListener, Input, Output } from '@angular/core';
import * as i0 from "@angular/core";
import * as i1 from "./ngx-plaid-link.service";
function getWindow() {
    return window;
}
export class NgxPlaidLinkDirective {
    constructor(plaidLinkLoader) {
        this.plaidLinkLoader = plaidLinkLoader;
        this.Event = new EventEmitter();
        this.Click = new EventEmitter();
        this.Load = new EventEmitter();
        this.Exit = new EventEmitter();
        this.Success = new EventEmitter();
        this.defaultProps = {
            apiVersion: "v2",
            env: "sandbox",
            institution: null,
            selectAccount: false,
            publicKey: null,
            token: null,
            webhook: "",
            product: ["auth"],
            countryCodes: ["US"],
            receivedRedirectUri: null,
            isWebview: false,
        };
        this.publicKey = this.defaultProps.publicKey;
        this.apiVersion = this.defaultProps.apiVersion;
        this.env = this.defaultProps.env;
        this.institution = this.defaultProps.institution;
        this.product = this.defaultProps.product;
        this.selectAccount = this.defaultProps.selectAccount;
        this.token = this.defaultProps.token;
        this.webhook = this.defaultProps.webhook;
        this.countryCodes = this.defaultProps.countryCodes;
        this.receivedRedirectUri = this.defaultProps.receivedRedirectUri;
        this.isWebview = this.defaultProps.isWebview;
        this.disabledButton = true;
    }
    async ngOnInit() {
        let handler = await this.plaidLinkLoader
            .createPlaid({
            env: this.env,
            key: this.publicKey,
            product: this.product,
            apiVersion: "v2",
            clientName: this.clientName,
            countryCodes: this.countryCodes,
            onSuccess: (public_token, metadata) => this.onSuccess(public_token, metadata),
            onExit: (err, metadata) => this.onExit(err, metadata),
            onEvent: (eventName, metadata) => this.onEvent(eventName, metadata),
            onLoad: () => this.onLoad(),
            selectAccount: this.selectAccount,
            token: this.token || null,
            webhook: this.webhook || null,
            receivedRedirectUri: this.receivedRedirectUri,
            isWebview: this.isWebview
        });
        this.disabledButton = false;
        this.plaidLinkHandler = handler;
    }
    onExit(error, metadata) {
        this.Exit.emit({ error, metadata });
    }
    onEvent(eventName, metadata) {
        this.Event.emit({ eventName, metadata });
    }
    onSuccess(token, metadata) {
        this.Success.emit({ token, metadata });
    }
    onClick($event) {
        this.Click.emit($event);
        // Open to a specific institution if necessary;
        const institution = this.institution || null;
        if (this.plaidLinkHandler) {
            this.plaidLinkHandler.open(institution);
        }
    }
    onLoad($event = "link_loaded") {
        this.Load.emit($event);
    }
}
NgxPlaidLinkDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: NgxPlaidLinkDirective, deps: [{ token: i1.NgxPlaidLinkService }], target: i0.ɵɵFactoryTarget.Directive });
NgxPlaidLinkDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "13.1.3", type: NgxPlaidLinkDirective, selector: "[ngxPlaidLink]", inputs: { clientName: "clientName", publicKey: "publicKey", apiVersion: "apiVersion", env: "env", institution: "institution", product: "product", selectAccount: "selectAccount", token: "token", webhook: "webhook", countryCodes: "countryCodes", receivedRedirectUri: "receivedRedirectUri", isWebview: "isWebview" }, outputs: { Event: "Event", Click: "Click", Load: "Load", Exit: "Exit", Success: "Success" }, host: { listeners: { "click": "onClick($event)" }, properties: { "disabled": "this.disabledButton" } }, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: NgxPlaidLinkDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[ngxPlaidLink]'
                }]
        }], ctorParameters: function () { return [{ type: i1.NgxPlaidLinkService }]; }, propDecorators: { Event: [{
                type: Output
            }], Click: [{
                type: Output
            }], Load: [{
                type: Output
            }], Exit: [{
                type: Output
            }], Success: [{
                type: Output
            }], clientName: [{
                type: Input
            }], disabledButton: [{
                type: HostBinding,
                args: ['disabled']
            }], publicKey: [{
                type: Input
            }], apiVersion: [{
                type: Input
            }], env: [{
                type: Input
            }], institution: [{
                type: Input
            }], product: [{
                type: Input
            }], selectAccount: [{
                type: Input
            }], token: [{
                type: Input
            }], webhook: [{
                type: Input
            }], countryCodes: [{
                type: Input
            }], receivedRedirectUri: [{
                type: Input
            }], isWebview: [{
                type: Input
            }], onClick: [{
                type: HostListener,
                args: ['click', ['$event']]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXBsYWlkLWxpbmsuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2xpYi9uZ3gtcGxhaWQtbGluay5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsV0FBVyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDOzs7QUFhbEcsU0FBUyxTQUFTO0lBQ2hCLE9BQU8sTUFBTSxDQUFDO0FBQ2hCLENBQUM7QUFXRCxNQUFNLE9BQU8scUJBQXFCO0lBd0NoQyxZQUFvQixlQUFvQztRQUFwQyxvQkFBZSxHQUFmLGVBQWUsQ0FBcUI7UUF2QzlDLFVBQUssR0FBbUMsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUMzRCxVQUFLLEdBQXNCLElBQUksWUFBWSxFQUFFLENBQUM7UUFDOUMsU0FBSSxHQUFzQixJQUFJLFlBQVksRUFBRSxDQUFDO1FBQzdDLFNBQUksR0FBa0MsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUN6RCxZQUFPLEdBQXFDLElBQUksWUFBWSxFQUFFLENBQUM7UUFRakUsaUJBQVksR0FBRztZQUNyQixVQUFVLEVBQUUsSUFBSTtZQUNoQixHQUFHLEVBQUUsU0FBUztZQUNkLFdBQVcsRUFBRSxJQUFJO1lBQ2pCLGFBQWEsRUFBRSxLQUFLO1lBQ3BCLFNBQVMsRUFBRSxJQUFJO1lBQ2YsS0FBSyxFQUFFLElBQUk7WUFDWCxPQUFPLEVBQUUsRUFBRTtZQUNYLE9BQU8sRUFBRSxDQUFDLE1BQU0sQ0FBQztZQUNqQixZQUFZLEVBQUUsQ0FBQyxJQUFJLENBQUM7WUFDcEIsbUJBQW1CLEVBQUUsSUFBSTtZQUN6QixTQUFTLEVBQUUsS0FBSztTQUNqQixDQUFDO1FBRU8sY0FBUyxHQUFZLElBQUksQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDO1FBQ2pELGVBQVUsR0FBWSxJQUFJLENBQUMsWUFBWSxD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SSxJQUFJLENBQUM7UUFDN0MsSUFBSSxJQUFJLENBQUMsZ0JBQWdCLEVBQUU7WUFDekIsSUFBSSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztTQUN6QztJQUNILENBQUM7SUFFTSxNQUFNLENBQUMsTUFBTSxHQUFHLGFBQWE7UUFDbEMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDekIsQ0FBQzs7a0hBM0ZVLHFCQUFxQjtzR0FBckIscUJBQXFCOzJGQUFyQixxQkFBcUI7a0JBSGpDLFNBQVM7bUJBQUM7b0JBQ1QsUUFBUSxFQUFFLGdCQUFnQjtpQkFDM0I7MEdBRVcsS0FBSztzQkFBZCxNQUFNO2dCQUNHLEtBQUs7c0JBQWQsTUFBTTtnQkFDRyxJQUFJO3NCQUFiLE1BQU07Z0JBQ0csSUFBSTtzQkFBYixNQUFNO2dCQUNHLE9BQU87c0JBQWhCLE1BQU07Z0JBRUUsVUFBVTtzQkFBbEIsS0FBSztnQkFHbUIsY0FBYztzQkFBdEMsV0FBVzt1QkFBQyxVQUFVO2dCQWlCZCxTQUFTO3NCQUFqQixLQUFLO2dCQUNHLFVBQVU7c0JBQWxCLEtBQUs7Z0JBQ0csR0FBRztzQkFBWCxLQUFLO2dCQUNHLFdBQVc7c0JBQW5CLEtBQUs7Z0JBQ0csT0FBTztzQkFBZixLQUFLO2dCQUNHLGFBQWE7c0JBQXJCLEtBQUs7Z0JBQ0csS0FBSztzQkFBYixLQUFLO2dCQUNHLE9BQU87c0JBQWYsS0FBSztnQkFDRyxZQUFZO3NCQUFwQixLQUFLO2dCQUNHLG1CQUFtQjtzQkFBM0IsS0FBSztnQkFDRyxTQUFTO3NCQUFqQixLQUFLO2dCQTJDTixPQUFPO3NCQUROLFlBQVk7dUJBQUMsT0FBTyxFQUFFLENBQUMsUUFBUSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGlyZWN0aXZlLCBFdmVudEVtaXR0ZXIsIEhvc3RCaW5kaW5nLCBIb3N0TGlzdGVuZXIsIElucHV0LCBPdXRwdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFBsYWlkTGlua0hhbmRsZXIgfSBmcm9tICcuL25neC1wbGFpZC1saW5rLWhhbmRsZXInO1xuaW1wb3J0IHtcbiAgUGxhaWRFcnJvck1ldGFkYXRhLFxuICBQbGFpZEVycm9yT2JqZWN0LFxuICBQbGFpZEV2ZW50TWV0YWRhdGEsXG4gIFBsYWlkT25FdmVudEFyZ3MsXG4gIFBsYWlkT25FeGl0QXJncyxcbiAgUGxhaWRPblN1Y2Nlc3NBcmdzLFxuICBQbGFpZFN1Y2Nlc3NNZXRhZGF0YVxufSBmcm9tICcuL2ludGVyZmFjZXMnO1xuaW1wb3J0IHsgTmd4UGxhaWRMaW5rU2VydmljZSB9IGZyb20gJy4vbmd4LXBsYWlkLWxpbmsuc2VydmljZSc7XG5cbmZ1bmN0aW9uIGdldFdpbmRvdygpOiBhbnkge1xuICByZXR1cm4gd2luZG93O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIElDdXN0b21XaW5kb3cgZXh0ZW5kcyBXaW5kb3cge1xuICBQbGFpZDoge1xuICAgIGNyZWF0ZTogRnVuY3Rpb247XG4gIH07XG59XG5cbkBEaXJlY3RpdmUoe1xuICBzZWxlY3RvcjogJ1tuZ3hQbGFpZExpbmtdJ1xufSlcbmV4cG9ydCBjbGFzcyBOZ3hQbGFpZExpbmtEaXJlY3RpdmUge1xuICBAT3V0cHV0KCkgRXZlbnQ6IEV2ZW50RW1pdHRlcjxQbGFpZE9uRXZlbnRBcmdzPiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgQE91dHB1dCgpIENsaWNrOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgQE91dHB1dCgpIExvYWQ6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICBAT3V0cHV0KCkgRXhpdDogRXZlbnRFbWl0dGVyPFBsYWlkT25FeGl0QXJncz4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIEBPdXRwdXQoKSBTdWNjZXNzOiBFdmVudEVtaXR0ZXI8UGxhaWRPblN1Y2Nlc3NBcmdzPiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICBASW5wdXQoKSBjbGllbnROYW1lOiBzdHJpbmc7XG4gIFxuXG4gIEBIb3N0QmluZGluZygnZGlzYWJsZWQnKSBkaXNhYmxlZEJ1dHRvbjogYm9vbGVhbjtcblxuICBwcml2YXRlIHBsYWlkTGlua0hhbmRsZXI6IFBsYWlkTGlua0hhbmRsZXI7XG4gIHByaXZhdGUgZGVmYXVsdFByb3BzID0ge1xuICAgIGFwaVZlcnNpb246IFwidjJcIixcbiAgICBlbnY6IFwic2FuZGJveFwiLFxuICAgIGluc3RpdHV0aW9uOiBudWxsLFxuICAgIHNlbGVjdEFjY291bnQ6IGZhbHNlLFxuICAgIHB1YmxpY0tleTogbnVsbCxcbiAgICB0b2tlbjogbnVsbCxcbiAgICB3ZWJob29rOiBcIlwiLFxuICAgIHByb2R1Y3Q6IFtcImF1dGhcIl0sXG4gICAgY291bnRyeUNvZGVzOiBbXCJVU1wiXSxcbiAgICByZWNlaXZlZFJlZGlyZWN0VXJpOiBudWxsLFxuICAgIGlzV2VidmlldzogZmFsc2UsXG4gIH07XG5cbiAgQElucHV0KCkgcHVibGljS2V5Pzogc3RyaW5nID0gdGhpcy5kZWZhdWx0UHJvcHMucHVibGljS2V5O1xuICBASW5wdXQoKSBhcGlWZXJzaW9uPzogc3RyaW5nID0gdGhpcy5kZWZhdWx0UHJvcHMuYXBpVmVyc2lvbjtcbiAgQElucHV0KCkgZW52Pzogc3RyaW5nID0gdGhpcy5kZWZhdWx0UHJvcHMuZW52O1xuICBASW5wdXQoKSBpbnN0aXR1dGlvbj86IHN0cmluZyA9IHRoaXMuZGVmYXVsdFByb3BzLmluc3RpdHV0aW9uO1xuICBASW5wdXQoKSBwcm9kdWN0PzogQXJyYXk8c3RyaW5nPiA9IHRoaXMuZGVmYXVsdFByb3BzLnByb2R1Y3Q7XG4gIEBJbnB1dCgpIHNlbGVjdEFjY291bnQ/OiBib29sZWFuID0gdGhpcy5kZWZhdWx0UHJvcHMuc2VsZWN0QWNjb3VudDtcbiAgQElucHV0KCkgdG9rZW4/OiBzdHJpbmcgPSB0aGlzLmRlZmF1bHRQcm9wcy50b2tlbjtcbiAgQElucHV0KCkgd2ViaG9vaz86IHN0cmluZyA9IHRoaXMuZGVmYXVsdFByb3BzLndlYmhvb2s7XG4gIEBJbnB1dCgpIGNvdW50cnlDb2Rlcz86IHN0cmluZ1tdID0gdGhpcy5kZWZhdWx0UHJvcHMuY291bnRyeUNvZGVzO1xuICBASW5wdXQoKSByZWNlaXZlZFJlZGlyZWN0VXJpPzogc3RyaW5nID0gdGhpcy5kZWZhdWx0UHJvcHMucmVjZWl2ZWRSZWRpcmVjdFVyaTtcbiAgQElucHV0KCkgaXNXZWJ2aWV3PzogYm9vbGVhbiA9IHRoaXMuZGVmYXVsdFByb3BzLmlzV2VidmlldztcblxuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcGxhaWRMaW5rTG9hZGVyOiBOZ3hQbGFpZExpbmtTZXJ2aWNlKSB7XG4gICAgdGhpcy5kaXNhYmxlZEJ1dHRvbiA9IHRydWU7XG4gIH1cblxuICBhc3luYyBuZ09uSW5pdCgpIHtcbiAgICBsZXQgaGFuZGxlcjogUGxhaWRMaW5rSGFuZGxlciA9IGF3YWl0IHRoaXMucGxhaWRMaW5rTG9hZGVyXG4gICAgICAuY3JlYXRlUGxhaWQoe1xuICAgICAgICBlbnY6IHRoaXMuZW52LFxuICAgICAgICBrZXk6IHRoaXMucHVibGljS2V5LFxuICAgICAgICBwcm9kdWN0OiB0aGlzLnByb2R1Y3QsXG4gICAgICAgIGFwaVZlcnNpb246IFwidjJcIixcbiAgICAgICAgY2xpZW50TmFtZTogdGhpcy5jbGllbnROYW1lLFxuICAgICAgICBjb3VudHJ5Q29kZXM6IHRoaXMuY291bnRyeUNvZGVzLFxuICAgICAgICBvblN1Y2Nlc3M6IChwdWJsaWNfdG9rZW4sIG1ldGFkYXRhKSA9PiB0aGlzLm9uU3VjY2VzcyhwdWJsaWNfdG9rZW4sIG1ldGFkYXRhKSxcbiAgICAgICAgb25FeGl0OiAoZXJyLCBtZXRhZGF0YSkgPT4gdGhpcy5vbkV4aXQoZXJyLCBtZXRhZGF0YSksXG4gICAgICAgIG9uRXZlbnQ6IChldmVudE5hbWUsIG1ldGFkYXRhKSA9PiB0aGlzLm9uRXZlbnQoZXZlbnROYW1lLCBtZXRhZGF0YSksXG4gICAgICAgIG9uTG9hZDogKCkgPT4gdGhpcy5vbkxvYWQoKSxcbiAgICAgICAgc2VsZWN0QWNjb3VudDogdGhpcy5zZWxlY3RBY2NvdW50LFxuICAgICAgICB0b2tlbjogdGhpcy50b2tlbiB8fCBudWxsLFxuICAgICAgICB3ZWJob29rOiB0aGlzLndlYmhvb2sgfHwgbnVsbCxcbiAgICAgICAgcmVjZWl2ZWRSZWRpcmVjdFVyaTogdGhpcy5yZWNlaXZlZFJlZGlyZWN0VXJpLFxuICAgICAgICBpc1dlYnZpZXc6IHRoaXMuaXNXZWJ2aWV3XG4gICAgICB9KTtcbiAgICB0aGlzLmRpc2FibGVkQnV0dG9uID0gZmFsc2U7XG4gICAgdGhpcy5wbGFpZExpbmtIYW5kbGVyID0gaGFuZGxlcjtcbiAgfVxuXG4gIHB1YmxpYyBvbkV4aXQoZXJyb3I6IFBsYWlkRXJyb3JPYmplY3QsIG1ldGFkYXRhOiBQbGFpZEVycm9yTWV0YWRhdGEpIHtcbiAgICB0aGlzLkV4aXQuZW1pdCh7ZXJyb3IsIG1ldGFkYXRhfSk7XG4gIH1cblxuICBwdWJsaWMgb25FdmVudChldmVudE5hbWU6IHN0cmluZywgbWV0YWRhdGE6IFBsYWlkRXZlbnRNZXRhZGF0YSkge1xuICAgIHRoaXMuRXZlbnQuZW1pdCh7ZXZlbnROYW1lLCBtZXRhZGF0YX0pO1xuICB9XG5cbiAgcHVibGljIG9uU3VjY2Vzcyh0b2tlbjogc3RyaW5nLCBtZXRhZGF0YTogUGxhaWRTdWNjZXNzTWV0YWRhdGEpIHtcbiAgICB0aGlzLlN1Y2Nlc3MuZW1pdCh7dG9rZW4sIG1ldGFkYXRhfSk7XG4gIH1cblxuICBASG9zdExpc3RlbmVyKCdjbGljaycsIFsnJGV2ZW50J10pXG4gIG9uQ2xpY2soJGV2ZW50KSB7XG4gICAgdGhpcy5DbGljay5lbWl0KCRldmVudCk7XG4gICAgLy8gT3BlbiB0byBhIHNwZWNpZmljIGluc3RpdHV0aW9uIGlmIG5lY2Vzc2FyeTtcbiAgICBjb25zdCBpbnN0aXR1dGlvbiA9IHRoaXMuaW5zdGl0dXRpb24gfHwgbnVsbDtcbiAgICBpZiAodGhpcy5wbGFpZExpbmtIYW5kbGVyKSB7XG4gICAgICB0aGlzLnBsYWlkTGlua0hhbmRsZXIub3BlbihpbnN0aXR1dGlvbik7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIG9uTG9hZCgkZXZlbnQgPSBcImxpbmtfbG9hZGVkXCIpIHtcbiAgICB0aGlzLkxvYWQuZW1pdCgkZXZlbnQpO1xuICB9XG59XG4iXX0=